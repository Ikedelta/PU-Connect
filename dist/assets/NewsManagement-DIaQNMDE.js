import{j as e}from"./query-vendor-Cpskl8RO.js";import{u as z,r}from"./react-vendor-Bsfkyusf.js";import{u as O,s as u,N as H}from"./index-DVwrR-_V.js";import"./i18n-vendor-CQdsz7qV.js";import"./supabase-vendor-C3liu3n-.js";function Q(){const{profile:n}=O(),p=z(),[D,E]=r.useState([]),[U,j]=r.useState(!0),[o,$]=r.useState("all"),[f,P]=r.useState(""),[q,b]=r.useState(!1),[h,w]=r.useState(null),[l,d]=r.useState({title:"",content:"",category:"General",image_url:"",status:"draft",scheduled_at:""}),[N,v]=r.useState(!1),[k,y]=r.useState(!1),[g,_]=r.useState(!1);r.useEffect(()=>{(n?.role==="admin"||n?.role==="super_admin"||n?.role==="news_publisher")&&m()},[o]),r.useEffect(()=>{if(n?.role!=="admin"&&n?.role!=="super_admin"&&n?.role!=="news_publisher"){p("/marketplace");return}m()},[n,p]);const m=async()=>{j(!0);try{let t=u.from("campus_news").select("*, author:profiles!author_id(full_name)").order("created_at",{ascending:!1});o==="published"?t=t.eq("is_published",!0):o==="draft"?t=t.eq("is_published",!1).is("scheduled_at",null):o==="scheduled"&&(t=t.not("scheduled_at","is",null));const{data:s,error:a}=await t;if(a)throw a;E(s||[])}catch(t){console.error("Error fetching news:",t)}finally{j(!1)}},S=async(t,s="news-images")=>{try{const a=t.name.split(".").pop(),c=`${`${Math.random().toString(36).substring(2)}_${Date.now()}.${a}`}`,{error:i}=await u.storage.from(s).upload(c,t);if(i)return console.error("Upload Error:",i),alert(`Upload failed: ${i.message}. Ensure 'news-images' bucket exists and is public.`),null;const{data:T}=u.storage.from(s).getPublicUrl(c);return T.publicUrl}catch(a){return console.error("Upload logic error",a),null}},A=async t=>{if(!t.target.files||t.target.files.length===0)return;y(!0);const s=t.target.files[0],a=await S(s);a&&d(x=>({...x,image_url:a})),y(!1)},L=async t=>{if(!t.target.files||t.target.files.length===0)return;_(!0);const s=t.target.files[0],a=await S(s);if(a){const x=`
![${s.name}](${a})
`;d(c=>({...c,content:c.content+x}))}_(!1)},F=async t=>{t.preventDefault(),v(!0);try{const{status:s,scheduled_at:a,...x}=l,c={...x,author_id:n?.id,is_published:s==="published",scheduled_at:s==="scheduled"&&a?new Date(a).toISOString():null};if(h){const{error:i}=await u.from("campus_news").update(c).eq("id",h.id);if(i)throw i}else{const{error:i}=await u.from("campus_news").insert([c]);if(i)throw i}b(!1),w(null),d({title:"",content:"",category:"General",image_url:"",status:"draft",scheduled_at:""}),m()}catch(s){alert(s.message||"Failed to save news")}finally{v(!1)}},I=t=>{w(t),d({title:t.title,content:t.content,category:t.category,image_url:t.image_url||"",status:t.scheduled_at?"scheduled":t.is_published?"published":"draft",scheduled_at:t.scheduled_at?new Date(t.scheduled_at).toISOString().slice(0,16):""}),b(!0)},M=async t=>{if(confirm("Are you sure you want to delete this news article?"))try{const{error:s}=await u.from("campus_news").delete().eq("id",t);if(s)throw s;m()}catch(s){alert(s.message||"Failed to delete news")}},G=async(t,s)=>{try{const{error:a}=await u.from("campus_news").update({is_published:!s,scheduled_at:null}).eq("id",t);if(a)throw a;m()}catch(a){alert(a.message||"Failed to update status")}},C=D.filter(t=>{if(o!=="all")if(o==="scheduled"){if(!t.scheduled_at)return!1}else{const s=o==="published";if(t.is_published!==s||t.scheduled_at)return!1}if(f){const s=f.toLowerCase();return t.title.toLowerCase().includes(s)||t.category.toLowerCase().includes(s)||t.author?.full_name.toLowerCase().includes(s)}return!0});return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 transition-colors duration-300 pb-20 font-sans",children:[e.jsx(H,{}),e.jsxs("div",{className:"pt-32 md:pt-40 pb-12 box-border max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6 mb-10",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"px-3 py-1 rounded-full bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 text-[10px] font-bold uppercase tracking-widest border border-purple-200 dark:border-purple-800",children:"Editorial Dashboard"})}),e.jsx("h1",{className:"text-3xl md:text-5xl font-black text-slate-900 dark:text-white tracking-tight mb-2",children:"News Management"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-medium",children:"Create and manage campus news articles"})]}),e.jsxs("div",{className:"flex gap-3",children:[n?.role==="admin"||n?.role==="super_admin"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>p("/admin/dashboard"),className:"px-6 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors text-xs font-bold uppercase tracking-wide whitespace-nowrap cursor-pointer flex items-center gap-2",children:[e.jsx("i",{className:"ri-dashboard-line text-lg"}),"Admin Dash"]}),e.jsxs("button",{onClick:()=>p("/publisher"),className:"hidden md:flex px-6 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors text-xs font-bold uppercase tracking-wide whitespace-nowrap cursor-pointer items-center gap-2",children:[e.jsx("i",{className:"ri-article-line text-lg"}),"Publisher Portal"]})]}):e.jsxs("button",{onClick:()=>p("/publisher"),className:"px-6 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-200 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors text-xs font-bold uppercase tracking-wide whitespace-nowrap cursor-pointer flex items-center gap-2",children:[e.jsx("i",{className:"ri-arrow-left-line text-lg"}),"Dashboard"]}),e.jsxs("button",{onClick:()=>{w(null),d({title:"",content:"",category:"General",image_url:"",status:"draft",scheduled_at:""}),b(!0)},className:"px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors text-xs font-bold uppercase tracking-wide whitespace-nowrap cursor-pointer flex items-center gap-2 shadow-lg shadow-blue-200 dark:shadow-none",children:[e.jsx("i",{className:"ri-add-line text-lg"}),"Create News"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("i",{className:"ri-search-line absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search news by title, category, or author...",value:f,onChange:t=>P(t.target.value),className:"w-full pl-11 pr-4 py-3 bg-white dark:bg-slate-800 border-none rounded-2xl focus:ring-2 focus:ring-blue-500/20 text-slate-900 dark:text-white outline-none transition-all shadow-sm"})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 p-1.5 flex-shrink-0 shadow-sm overflow-x-auto",children:e.jsx("div",{className:"flex space-x-1",children:[{id:"all",label:"All Articles"},{id:"published",label:"Published"},{id:"draft",label:"Drafts"},{id:"scheduled",label:"Scheduled"}].map(t=>e.jsx("button",{onClick:()=>$(t.id),className:`px-4 py-2 text-xs font-bold uppercase tracking-wide rounded-xl transition-colors whitespace-nowrap cursor-pointer ${o===t.id?"bg-slate-900 dark:bg-white text-white dark:text-slate-900 shadow-md":"text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:t.label},t.id))})})]}),U?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"inline-block w-10 h-10 border-4 border-slate-200 border-t-blue-600 rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-xs font-bold uppercase tracking-widest text-slate-400",children:"Loading news..."})]}):C.length===0?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-[2rem] border border-slate-100 dark:border-slate-700 p-16 text-center shadow-sm",children:[e.jsx("div",{className:"w-20 h-20 bg-slate-50 dark:bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("i",{className:"ri-newspaper-line text-4xl text-slate-300 dark:text-slate-500"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-2",children:"No items found"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 max-w-sm mx-auto text-sm",children:"Try adjusting your filters or create a new article to get started."})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:C.map(t=>e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-3xl border border-slate-100 dark:border-slate-700 overflow-hidden hover:shadow-xl transition-shadow group",children:e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"w-full h-48 md:w-64 md:h-auto flex-shrink-0 relative overflow-hidden",children:[t.image_url?e.jsx("img",{src:t.image_url,alt:t.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"}):e.jsx("div",{className:"w-full h-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-300 dark:text-slate-600",children:e.jsx("i",{className:"ri-image-line text-4xl"})}),e.jsx("div",{className:"absolute top-4 left-4 md:hidden",children:e.jsx("span",{className:`px-3 py-1 text-[10px] font-bold uppercase tracking-widest rounded-full shadow-lg ${t.is_published?"bg-emerald-500 text-white":t.scheduled_at?"bg-purple-500 text-white":"bg-slate-800 text-white"}`,children:t.is_published?"Published":t.scheduled_at?"Scheduled":"Draft"})})]}),e.jsxs("div",{className:"flex-1 p-6 md:p-8 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4",children:[e.jsx("span",{className:"px-2.5 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-[10px] font-bold uppercase tracking-widest rounded-full border border-blue-200 dark:border-blue-800",children:t.category}),e.jsx("span",{className:`hidden md:inline-block px-2.5 py-0.5 text-[10px] font-bold uppercase tracking-widest rounded-full border ${t.is_published?"bg-emerald-50 text-emerald-700 border-emerald-200 dark:bg-emerald-900/20 dark:text-emerald-300":t.scheduled_at?"bg-purple-50 text-purple-700 border-purple-200 dark:bg-purple-900/20 dark:text-purple-300":"bg-slate-100 text-slate-600 border-slate-200 dark:bg-slate-700 dark:text-slate-300"}`,children:t.is_published?"Published":t.scheduled_at?"Scheduled":"Draft"}),e.jsxs("span",{className:"text-[10px] font-bold text-slate-400 flex items-center gap-1 ml-auto md:ml-0 uppercase tracking-wider",children:[e.jsx("i",{className:"ri-time-line"})," ",new Date(t.created_at).toLocaleDateString()]})]}),e.jsx("h3",{className:"text-xl md:text-2xl font-black text-slate-900 dark:text-white mb-3 leading-tight tracking-tight",children:t.title}),e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 line-clamp-2 md:line-clamp-2 mb-6 leading-relaxed",children:t.content}),t.scheduled_at&&e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-purple-600 dark:text-purple-400 bg-purple-50 dark:bg-purple-900/20 px-4 py-2 rounded-xl mb-6 w-fit border border-purple-100 dark:border-purple-800",children:[e.jsx("i",{className:"ri-calendar-event-line text-lg"}),"Scheduled for: ",new Date(t.scheduled_at).toLocaleString()]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-6 mt-auto pt-6 border-t border-slate-50 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-6 text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wide",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("i",{className:"ri-user-smile-line text-lg text-slate-300"}),t.author?.full_name||"Unknown"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("i",{className:"ri-eye-line text-lg text-slate-300"}),t.views_count.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>I(t),className:"flex-1 sm:flex-none px-4 py-2.5 bg-slate-50 dark:bg-slate-700 text-slate-700 dark:text-slate-200 text-xs font-bold uppercase tracking-wider rounded-xl hover:bg-slate-100 dark:hover:bg-slate-600 border border-slate-200 dark:border-slate-600 transition-colors whitespace-nowrap",children:[e.jsx("i",{className:"ri-edit-line mr-1"})," Edit"]}),e.jsxs("button",{onClick:()=>G(t.id,t.is_published),className:`flex-1 sm:flex-none px-4 py-2.5 text-xs font-bold uppercase tracking-wider rounded-xl transition-colors whitespace-nowrap border ${t.is_published?"bg-amber-50 text-amber-700 border-amber-200 hover:bg-amber-100 dark:bg-amber-900/20 dark:text-amber-300 dark:border-amber-800":"bg-emerald-50 text-emerald-700 border-emerald-200 hover:bg-emerald-100 dark:bg-emerald-900/20 dark:text-emerald-300 dark:border-emerald-800"}`,children:[e.jsx("i",{className:`${t.is_published?"ri-eye-off-line":"ri-send-plane-line"} mr-1`}),t.is_published?"Unpublish":"Publish"]}),e.jsx("button",{onClick:()=>M(t.id),className:"flex-none px-4 py-2.5 bg-rose-50 dark:bg-rose-900/20 text-rose-700 dark:text-rose-400 border border-rose-200 dark:border-rose-900/30 text-xs font-bold uppercase tracking-wider rounded-xl hover:bg-rose-100 dark:hover:bg-rose-900/40 transition-colors",children:e.jsx("i",{className:"ri-delete-bin-line text-lg"})})]})]})]})]})},t.id))})]}),q&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"sticky top-0 bg-white/95 dark:bg-slate-900/95 border-b border-slate-100 dark:border-slate-800 px-8 py-6 flex items-center justify-between z-10 backdrop-blur",children:[e.jsx("h3",{className:"text-2xl font-black text-slate-900 dark:text-white tracking-tight",children:h?"Edit Story":"Compose News"}),e.jsx("button",{onClick:()=>b(!1),className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-500 hover:bg-slate-200 transition-colors",children:e.jsx("i",{className:"ri-close-line text-xl"})})]}),e.jsxs("form",{onSubmit:F,className:"p-8 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wide text-slate-500 mb-2",children:"Headline *"}),e.jsx("input",{type:"text",value:l.title,onChange:t=>d({...l,title:t.target.value}),required:!0,className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border-none rounded-xl focus:ring-2 focus:ring-blue-500/50 outline-none font-medium text-slate-900 dark:text-white",placeholder:"Enter a catchy headline"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wide text-slate-500 mb-2",children:"Category *"}),e.jsxs("select",{value:l.category,onChange:t=>d({...l,category:t.target.value}),required:!0,className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border-none rounded-xl focus:ring-2 focus:ring-blue-500/50 outline-none font-medium text-slate-900 dark:text-white cursor-pointer",children:[e.jsx("option",{value:"General",children:"General"}),e.jsx("option",{value:"Events",children:"Events"}),e.jsx("option",{value:"Academic",children:"Academic"}),e.jsx("option",{value:"Sports",children:"Sports"}),e.jsx("option",{value:"Announcements",children:"Announcements"}),e.jsx("option",{value:"Ads",children:"Advertisements"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wide text-slate-500 mb-2",children:"Content *"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:l.content,onChange:t=>d({...l,content:t.target.value}),required:!0,rows:10,className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border-none rounded-xl focus:ring-2 focus:ring-blue-500/50 outline-none font-medium text-slate-900 dark:text-white resize-none",placeholder:"Write your story here..."}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs("label",{className:`
                          flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-slate-700 rounded-lg text-xs font-bold uppercase tracking-wide shadow-sm cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors
                          ${g?"opacity-50 cursor-not-allowed":""}
                       `,children:[g?e.jsx("i",{className:"ri-loader-4-line animate-spin"}):e.jsx("i",{className:"ri-image-add-line"}),g?"Uploading...":"Insert Image",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:L,disabled:g})]})})]}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-2",children:"* Pro Tip: Upload images to automatically insert them into your current cursor position."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wide text-slate-500 mb-2",children:"Cover Image"}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"url",value:l.image_url,onChange:t=>d({...l,image_url:t.target.value}),className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border-none rounded-xl focus:ring-2 focus:ring-blue-500/50 outline-none font-medium text-slate-900 dark:text-white",placeholder:"https://example.com/image.jpg"})}),e.jsxs("label",{className:`
                        flex items-center justify-center w-12 h-12 bg-slate-100 dark:bg-slate-800 rounded-xl cursor-pointer hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors flex-shrink-0
                        ${k?"opacity-50":""}
                    `,children:[k?e.jsx("i",{className:"ri-loader-4-line animate-spin text-xl text-slate-500"}):e.jsx("i",{className:"ri-upload-cloud-2-line text-xl text-slate-500"}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:A,disabled:k})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wide text-slate-500 mb-2",children:"Publishing Status *"}),e.jsxs("select",{value:l.status,onChange:t=>d({...l,status:t.target.value}),required:!0,className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border-none rounded-xl focus:ring-2 focus:ring-blue-500/50 outline-none font-medium text-slate-900 dark:text-white cursor-pointer",children:[e.jsx("option",{value:"draft",children:"Save as Draft"}),e.jsx("option",{value:"published",children:"Publish Immediately"}),e.jsx("option",{value:"scheduled",children:"Schedule for Later"})]})]}),l.status==="scheduled"&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wide text-slate-500 mb-2",children:"Schedule Date & Time *"}),e.jsx("input",{type:"datetime-local",value:l.scheduled_at,onChange:t=>d({...l,scheduled_at:t.target.value}),required:l.status==="scheduled",className:"w-full px-4 py-3 bg-blue-50/50 dark:bg-blue-900/20 border-2 border-blue-100 dark:border-blue-900 rounded-xl focus:ring-2 focus:ring-blue-500/50 outline-none font-bold text-blue-900 dark:text-blue-200"})]})]}),e.jsxs("div",{className:"flex space-x-4 pt-6 sticky bottom-0 bg-white dark:bg-slate-900 z-10",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"flex-1 py-4 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 font-bold rounded-xl hover:bg-slate-200 transition-colors uppercase tracking-widest text-xs",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:N,className:"flex-[2] py-4 bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-bold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 uppercase tracking-widest text-xs",children:N?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin text-lg"}),e.jsx("span",{children:"Saving..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-save-line text-lg"}),e.jsx("span",{children:h?"Update Story":"Create Story"})]})})]})]})]})})]})}export{Q as default};
//# sourceMappingURL=NewsManagement-DIaQNMDE.js.map
