import{_ as I}from"./supabase-vendor-C3liu3n-.js";import{j as e}from"./query-vendor-Cpskl8RO.js";import{u as L,r as t}from"./react-vendor-Bsfkyusf.js";import{u as M,s,N}from"./index-DVwrR-_V.js";import"./i18n-vendor-CQdsz7qV.js";function H(){const u=L(),{profile:l}=M(),[i,k]=t.useState([]),[_,S]=t.useState(!0),[c,A]=t.useState("all"),[g,h]=t.useState(null),[R,p]=t.useState(!1),[d,j]=t.useState(""),[n,x]=t.useState(!1);t.useEffect(()=>{if(l?.role!=="admin"&&l?.role!=="super_admin"){u("/");return}m();const r=s.channel("seller_applications_changes").on("postgres_changes",{event:"*",schema:"public",table:"seller_applications"},()=>{m()}).subscribe();return()=>{s.removeChannel(r)}},[l,u]);const m=async()=>{try{const{data:r,error:a}=await s.from("seller_applications").select(`
          *,
          profiles:user_id (
            full_name,
            email,
            student_id
          )
        `).order("created_at",{ascending:!1});if(a)throw a;k(r||[])}catch(r){console.error("Error fetching applications:",r)}finally{S(!1)}},E=async r=>{if(confirm(`Approve ${r.business_name}?`)){x(!0);try{const P=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(l?.id||"")?l?.id:null,{error:w}=await s.from("seller_applications").update({status:"approved",reviewed_at:new Date().toISOString(),reviewed_by:P,updated_at:new Date().toISOString()}).eq("id",r.id);if(w)throw w;const{error:v}=await s.from("profiles").update({role:"seller"}).eq("id",r.user_id);if(v)throw v;const{error:b}=await s.from("seller_profiles").insert({user_id:r.user_id,business_name:r.business_name,business_category:r.business_category,business_description:r.business_description,contact_phone:r.contact_phone,contact_email:r.contact_email,subscription_status:"inactive",is_active:!0});if(b&&b.code!=="23505")throw b;if(r.contact_phone)try{const{sendSMS:f}=await I(async()=>{const{sendSMS:$}=await import("./arkesel-BfobRff5.js");return{sendSMS:$}},[]),U=r.profiles?.full_name.split(" ")[0]||"User";await f([r.contact_phone],`Hi ${U}, congratulations! Your seller application for "${r.business_name}" on PU Connect has been APPROVED. You can now log in and start listing your products. Happy selling!`)}catch(f){console.error("Failed to send approval SMS:",f)}alert("Application approved successfully! SMS notification sent."),m()}catch(a){console.error("Error approving application:",a),alert("Failed to approve application: "+a.message)}finally{x(!1)}}},C=r=>{h(r),j(""),p(!0)},D=async()=>{if(!g||!d.trim()){alert("Please provide a rejection reason");return}x(!0);try{const{error:r}=await s.from("seller_applications").update({status:"rejected",rejection_reason:d,updated_at:new Date().toISOString()}).eq("id",g.id);if(r)throw r;alert("Application rejected"),p(!1),h(null),m()}catch(r){console.error("Error rejecting application:",r),alert("Failed to reject application: "+r.message)}finally{x(!1)}},y=i.filter(r=>c==="all"?!0:r.status===c),o={total:i.length,pending:i.filter(r=>r.status==="pending").length,approved:i.filter(r=>r.status==="approved").length,rejected:i.filter(r=>r.status==="rejected").length};return _?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950 transition-colors duration-300",children:[e.jsx(N,{}),e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-teal-600 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading applications..."})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950 transition-colors duration-300",children:[e.jsx(N,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-32 pb-12",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx("i",{className:"ri-file-list-3-line text-2xl text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Seller Applications"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Review and manage seller applications"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-100 dark:border-gray-800 shadow-sm transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Total Applications"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:o.total})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx("i",{className:"ri-file-list-line text-2xl text-white"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-100 dark:border-gray-800 shadow-sm transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Pending Review"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600 dark:text-yellow-400",children:o.pending})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx("i",{className:"ri-time-line text-2xl text-white"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-100 dark:border-gray-800 shadow-sm transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Approved"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:o.approved})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx("i",{className:"ri-checkbox-circle-line text-2xl text-white"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-100 dark:border-gray-800 shadow-sm transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Rejected"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:o.rejected})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx("i",{className:"ri-close-circle-line text-2xl text-white"})})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-2 mb-6 border border-gray-100 dark:border-gray-800 shadow-sm inline-flex gap-2 w-full sm:w-auto overflow-x-auto transition-colors",children:["all","pending","approved","rejected"].map(r=>e.jsxs("button",{onClick:()=>A(r),className:`px-6 py-2 rounded-lg font-medium text-sm transition-all whitespace-nowrap cursor-pointer ${c===r?"bg-gradient-to-r from-teal-500 to-teal-600 text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[r.charAt(0).toUpperCase()+r.slice(1),r!=="all"&&e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full text-xs ${c===r?"bg-white/20":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400"}`,children:o[r]})]},r))}),e.jsx("div",{className:"space-y-4",children:y.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-12 text-center border border-gray-100 dark:border-gray-800 transition-colors",children:[e.jsx("i",{className:"ri-inbox-line text-6xl text-gray-300 dark:text-gray-700 mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No applications found"})]}):y.map(r=>e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-100 dark:border-gray-800 shadow-sm hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md",children:e.jsx("i",{className:"ri-store-3-line text-2xl text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:r.business_name}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${r.status==="approved"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":r.status==="rejected"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300"}`,children:r.status.toUpperCase()})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:[e.jsx("i",{className:"ri-user-line mr-1"}),r.profiles?.full_name]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("i",{className:"ri-price-tag-3-line mr-1"}),r.business_category]})]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 mb-4 transition-colors",children:e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 leading-relaxed",children:r.business_description})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("i",{className:"ri-phone-line text-teal-600 dark:text-teal-400"}),e.jsx("span",{children:r.contact_phone})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("i",{className:"ri-mail-line text-teal-600 dark:text-teal-400"}),e.jsx("span",{children:r.contact_email})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 dark:text-gray-500",children:[e.jsxs("span",{children:[e.jsx("i",{className:"ri-calendar-line mr-1"}),"Applied: ",new Date(r.created_at).toLocaleDateString()]}),r.updated_at!==r.created_at&&e.jsxs("span",{children:[e.jsx("i",{className:"ri-refresh-line mr-1"}),"Updated: ",new Date(r.updated_at).toLocaleDateString()]})]}),r.rejection_reason&&e.jsxs("div",{className:"mt-4 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-900/30 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 dark:text-red-300 mb-1",children:"Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200/80",children:r.rejection_reason})]})]}),r.status==="pending"&&e.jsxs("div",{className:"flex flex-col gap-3 lg:w-48",children:[e.jsxs("button",{onClick:()=>E(r),disabled:n,className:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer flex items-center justify-center gap-2 shadow-sm",children:[e.jsx("i",{className:"ri-checkbox-circle-line text-lg"}),"Approve"]}),e.jsxs("button",{onClick:()=>C(r),disabled:n,className:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer flex items-center justify-center gap-2 shadow-sm",children:[e.jsx("i",{className:"ri-close-circle-line text-lg"}),"Reject"]})]})]})},r.id))})]}),R&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center p-4 z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl max-w-md w-full p-6 shadow-2xl border border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx("i",{className:"ri-close-circle-line text-2xl text-white"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Reject Application"})]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:["Please provide a reason for rejecting ",e.jsx("strong",{children:g?.business_name})]}),e.jsx("textarea",{value:d,onChange:r=>j(r.target.value),placeholder:"Enter rejection reason...",rows:4,maxLength:500,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent resize-none mb-2 outline-none"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mb-4",children:[d.length,"/500 characters"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{p(!1),h(null)},disabled:n,className:"flex-1 px-6 py-3 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 cursor-pointer",children:"Cancel"}),e.jsx("button",{onClick:D,disabled:n||!d.trim(),className:"flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all font-medium text-sm whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer shadow-md",children:n?"Rejecting...":"Confirm Rejection"})]})]})})]})}export{H as default};
//# sourceMappingURL=SellerApplications-8-m9gCHJ.js.map
