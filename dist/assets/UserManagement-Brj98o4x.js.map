{"version":3,"mappings":"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","names":["UserManagement","navigate","useNavigate","profile","authLoading","useAuth","users","setUsers","useState","loading","setLoading","searchTerm","setSearchTerm","roleFilter","setRoleFilter","openDropdown","setOpenDropdown","selectedUser","setSelectedUser","showEditModal","setShowEditModal","showAddModal","setShowAddModal","newData","setNewData","editData","setEditData","saving","setSaving","showSuccessToast","setShowSuccessToast","useEffect","fetchUsers","channel","supabase","data","error","handleToggleActive","userId","currentStatus","u","prev","handleDeleteUser","previousUsers","handleAddUser","e","result","functionError","roleError","err","handleEditRole","user","handleSaveUser","sendSMS","__vitePreload","firstName","smsErr","showExportMenu","setShowExportMenu","handleExportData","category","usersToExport","csvContent","row","blob","url","a","filteredUsers","matchesSearch","matchesRole","isUserOnline","jsxs","jsx","Navbar","Fragment","opt","online","role"],"ignoreList":[],"sources":["../../src/pages/admin/UserManagement.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport { supabase } from '../../lib/supabase';\r\nimport Navbar from '../../components/feature/Navbar';\r\n\r\ntype User = {\r\n  id: string;\r\n  email: string;\r\n  full_name: string;\r\n  student_id: string | null;\r\n  department: string | null;\r\n  faculty: string | null;\r\n  phone: string | null;\r\n  role: string;\r\n  is_active: boolean;\r\n  created_at: string;\r\n  last_sign_in_at?: string; // Supabase auth often tracks this, we'll try to use it or mock it\r\n};\r\n\r\nexport default function UserManagement() {\r\n  const navigate = useNavigate();\r\n  const { profile, loading: authLoading } = useAuth();\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [roleFilter, setRoleFilter] = useState('all');\r\n  const [openDropdown, setOpenDropdown] = useState<string | null>(null);\r\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\r\n  const [showEditModal, setShowEditModal] = useState(false);\r\n  const [showAddModal, setShowAddModal] = useState(false);\r\n\r\n  // Add User State\r\n  const [newData, setNewData] = useState({\r\n    email: '',\r\n    password: '',\r\n    fullName: '',\r\n    department: '',\r\n    faculty: '',\r\n    phone: '',\r\n    role: 'buyer'\r\n  });\r\n\r\n  // Expanded Edit Data State\r\n  const [editData, setEditData] = useState({\r\n    full_name: '',\r\n    role: '',\r\n    department: '',\r\n    faculty: '',\r\n    student_id: '',\r\n    phone: '',\r\n    email: '',\r\n    created_at: '',\r\n    last_sign_in_at: ''\r\n  });\r\n\r\n  const [saving, setSaving] = useState(false);\r\n  const [showSuccessToast, setShowSuccessToast] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!authLoading && profile?.role !== 'admin' && profile?.role !== 'super_admin') {\r\n      navigate('/marketplace');\r\n    }\r\n  }, [profile, authLoading, navigate]);\r\n\r\n  useEffect(() => {\r\n    fetchUsers();\r\n\r\n    const channel = supabase\r\n      .channel('public:profiles')\r\n      .on(\r\n        'postgres_changes',\r\n        { event: '*', schema: 'public', table: 'profiles' },\r\n        () => {\r\n          fetchUsers();\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, []);\r\n\r\n  const fetchUsers = async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('profiles')\r\n        .select('*')\r\n        .order('created_at', { ascending: false })\r\n        .limit(100);\r\n\r\n      if (error) throw error;\r\n      setUsers(data || []);\r\n    } catch (error) {\r\n      console.error('Error fetching users:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleToggleActive = async (userId: string, currentStatus: boolean) => {\r\n    // Optimistic Update\r\n    setUsers(users.map(u => u.id === userId ? { ...u, is_active: !currentStatus } : u));\r\n    if (selectedUser?.id === userId) {\r\n      setSelectedUser(prev => prev ? { ...prev, is_active: !currentStatus } : null);\r\n    }\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from('profiles')\r\n        .update({ is_active: !currentStatus })\r\n        .eq('id', userId);\r\n\r\n      if (error) {\r\n        // Revert on error\r\n        setUsers(users.map(u => u.id === userId ? { ...u, is_active: currentStatus } : u));\r\n        throw error;\r\n      }\r\n\r\n      await fetchUsers();\r\n      setOpenDropdown(null);\r\n      alert(`User ${!currentStatus ? 'activated' : 'suspended'} successfully`);\r\n    } catch (error: any) {\r\n      console.error('Error updating user status:', error);\r\n      alert(`Failed to update user status: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const handleDeleteUser = async (userId: string) => {\r\n    if (userId === profile?.id) {\r\n      alert(\"You cannot delete your own account.\");\r\n      return;\r\n    }\r\n\r\n    if (!confirm('Are you sure you want to PERMANENTLY delete this user? This will remove their profile AND their authentication account, allowing them to sign up again if needed. This action cannot be undone.')) {\r\n      return;\r\n    }\r\n\r\n    const previousUsers = [...users];\r\n    setUsers(users.filter(u => u.id !== userId));\r\n\r\n    try {\r\n      // Call the Edge Function to delete from both Auth and Profiles\r\n      const { data, error } = await supabase.functions.invoke('delete-user', {\r\n        body: { userId }\r\n      });\r\n\r\n      if (error || !data?.success) {\r\n        setUsers(previousUsers);\r\n        throw error || new Error(data?.error || 'Failed to delete user');\r\n      }\r\n\r\n      setOpenDropdown(null);\r\n      alert('User account and profile permanently deleted');\r\n      fetchUsers();\r\n    } catch (error: any) {\r\n      console.error('Error deleting user:', error);\r\n      alert(`Failed to delete user: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const handleAddUser = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setSaving(true);\r\n\r\n    try {\r\n      // Create Account via Edge Function (Auto-confirms email)\r\n      const { data: result, error: functionError } = await supabase.functions.invoke('register-user', {\r\n        body: newData\r\n      });\r\n\r\n      if (functionError || !result?.success) {\r\n        throw new Error(functionError?.message || result?.error || 'Failed to create account');\r\n      }\r\n\r\n      // If specialty role was selected, update it (register-user defaults to buyer)\r\n      if (newData.role !== 'buyer') {\r\n        const { error: roleError } = await supabase\r\n          .from('profiles')\r\n          .update({ role: newData.role })\r\n          .eq('id', result.userId);\r\n        if (roleError) console.error('Failed to update role:', roleError);\r\n      }\r\n\r\n      alert('User created successfully and auto-confirmed!');\r\n      setShowAddModal(false);\r\n      setNewData({\r\n        email: '',\r\n        password: '',\r\n        fullName: '',\r\n        department: '',\r\n        faculty: '',\r\n        phone: '',\r\n        role: 'buyer'\r\n      });\r\n      fetchUsers();\r\n    } catch (err: any) {\r\n      alert(err.message || 'Failed to create user');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleEditRole = (user: User) => {\r\n    setSelectedUser(user);\r\n    setEditData({\r\n      full_name: user.full_name,\r\n      role: user.role,\r\n      department: user.department || '',\r\n      faculty: user.faculty || '',\r\n      student_id: user.student_id || '',\r\n      phone: user.phone || '',\r\n      email: user.email,\r\n      created_at: user.created_at,\r\n      last_sign_in_at: user.last_sign_in_at || ''\r\n    });\r\n    setShowEditModal(true);\r\n    setOpenDropdown(null);\r\n  };\r\n\r\n  const handleSaveUser = async () => {\r\n    if (!selectedUser) return;\r\n\r\n    setSaving(true);\r\n    try {\r\n      // Optimistic Update\r\n      setUsers(users.map(u => u.id === selectedUser.id ? {\r\n        ...u,\r\n        full_name: editData.full_name,\r\n        role: editData.role,\r\n        department: editData.department,\r\n        faculty: editData.faculty,\r\n        student_id: editData.student_id,\r\n        phone: editData.phone\r\n      } : u));\r\n\r\n      const { error } = await supabase\r\n        .from('profiles')\r\n        .update({\r\n          full_name: editData.full_name,\r\n          role: editData.role,\r\n          department: editData.department,\r\n          faculty: editData.faculty,\r\n          student_id: editData.student_id,\r\n          phone: editData.phone\r\n        })\r\n        .eq('id', selectedUser.id);\r\n\r\n      if (error) throw error;\r\n\r\n      // Send SMS Notification\r\n      if (selectedUser.role !== editData.role && editData.phone) {\r\n        try {\r\n          const { sendSMS } = await import('../../lib/arkesel');\r\n          const firstName = selectedUser.full_name.split(' ')[0];\r\n          await sendSMS(\r\n            [editData.phone],\r\n            `Hi ${firstName}, your role on PU Connect has been updated to \"${editData.role}\".`\r\n          );\r\n        } catch (smsErr) {\r\n          console.error('Failed to send role update SMS:', smsErr);\r\n        }\r\n      }\r\n\r\n      await fetchUsers();\r\n      setShowEditModal(false);\r\n      setSelectedUser(null);\r\n      setShowSuccessToast(true);\r\n      setTimeout(() => setShowSuccessToast(false), 3000);\r\n    } catch (error) {\r\n      console.error('Error updating profile:', error);\r\n      alert('Failed to update user profile');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const [showExportMenu, setShowExportMenu] = useState(false);\r\n\r\n  const handleExportData = (category?: string) => {\r\n    let usersToExport = users;\r\n    if (category) {\r\n      usersToExport = users.filter(u => u.role === category);\r\n    }\r\n    if (usersToExport.length === 0) {\r\n      alert('No users found for this category');\r\n      return;\r\n    }\r\n    const csvContent = [\r\n      ['Email', 'Full Name', 'Department', 'Faculty', 'Role', 'Status', 'Joined'],\r\n      ...usersToExport.map(user => [\r\n        `\"${user.email}\"`,\r\n        `\"${user.full_name}\"`,\r\n        `\"${user.department || ''}\"`,\r\n        `\"${user.faculty || ''}\"`,\r\n        user.role,\r\n        user.is_active ? 'Active' : 'Suspended',\r\n        new Date(user.created_at).toLocaleDateString()\r\n      ])\r\n    ].map(row => row.join(',')).join('\\n');\r\n\r\n    const blob = new Blob([csvContent], { type: 'text/csv' });\r\n    const url = window.URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `pentvars-users-${category || 'all'}.csv`;\r\n    a.click();\r\n    setShowExportMenu(false);\r\n  };\r\n\r\n  const filteredUsers = users.filter(user => {\r\n    const matchesSearch =\r\n      user.email.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n      user.full_name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n      (user.student_id && user.student_id.toLowerCase().includes(searchTerm.toLowerCase()));\r\n\r\n    const matchesRole = roleFilter === 'all' || user.role === roleFilter;\r\n\r\n    return matchesSearch && matchesRole;\r\n  });\r\n\r\n  // Mock function to determine online status\r\n  const isUserOnline = (user: User) => {\r\n    // In a real app, check `last_seen_at > 5 mins ago`.\r\n    // Here we'll just mock it based on even/odd ID char or `is_active` for visual variance\r\n    return user.is_active && (user.id.charCodeAt(0) % 3 === 0);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 dark:bg-slate-900 transition-colors duration-300 pb-20 font-sans\">\r\n      <Navbar />\r\n\r\n      <div className=\"pt-28 pb-12 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n        {/* Header */}\r\n        <div className=\"flex flex-col md:flex-row md:items-end justify-between gap-6 mb-10\">\r\n          <div>\r\n            <div className=\"flex items-center gap-2 mb-2\">\r\n              <span className=\"px-3 py-1 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-[10px] font-bold uppercase tracking-widest border border-blue-200 dark:border-blue-800\">\r\n                System Admin\r\n              </span>\r\n            </div>\r\n            <h1 className=\"text-3xl md:text-5xl font-black text-slate-900 dark:text-white tracking-tight mb-2\">\r\n              Users\r\n            </h1>\r\n            <p className=\"text-slate-500 dark:text-slate-400 font-medium\">\r\n              Manage platform accounts, permissions, and view user details.\r\n            </p>\r\n          </div>\r\n          <div className=\"flex items-center gap-3\">\r\n            <button\r\n              onClick={() => navigate('/admin/dashboard')}\r\n              className=\"px-5 py-2.5 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700 rounded-xl text-xs font-bold uppercase tracking-wide hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors shadow-sm cursor-pointer\"\r\n            >\r\n              <i className=\"ri-arrow-left-line mr-2\"></i>\r\n              Dashboard\r\n            </button>\r\n            <button\r\n              onClick={() => setShowAddModal(true)}\r\n              className=\"px-5 py-2.5 bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-xl text-xs font-bold uppercase tracking-wide hover:shadow-xl transition-all cursor-pointer flex items-center gap-2\"\r\n            >\r\n              <i className=\"ri-user-add-line text-lg\"></i>\r\n              Add User\r\n            </button>\r\n            <div className=\"relative\">\r\n              <button\r\n                onClick={() => setShowExportMenu(!showExportMenu)}\r\n                className=\"px-5 py-2.5 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700 rounded-xl text-xs font-bold uppercase tracking-wide hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors shadow-sm cursor-pointer flex items-center gap-2\"\r\n              >\r\n                <i className=\"ri-download-line text-lg\"></i>\r\n                Export\r\n              </button>\r\n              {showExportMenu && (\r\n                <>\r\n                  <div className=\"fixed inset-0 z-10\" onClick={() => setShowExportMenu(false)}></div>\r\n                  <div className=\"absolute right-0 top-full mt-2 w-48 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-100 dark:border-slate-700 py-1 z-20 overflow-hidden\">\r\n                    {['all', 'buyer', 'seller', 'admin'].map(opt => (\r\n                      <button key={opt} onClick={() => handleExportData(opt === 'all' ? undefined : opt)} className=\"w-full text-left px-4 py-3 text-xs font-bold text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 capitalize\">\r\n                        {opt} Users\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Filters */}\r\n        <div className=\"bg-white dark:bg-slate-800 rounded-2xl p-6 mb-8 border border-slate-100 dark:border-slate-700 shadow-sm\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <div className=\"relative\">\r\n              <i className=\"ri-search-line absolute left-4 top-1/2 -translate-y-1/2 text-slate-400\"></i>\r\n              <input\r\n                type=\"text\"\r\n                value={searchTerm}\r\n                onChange={(e) => setSearchTerm(e.target.value)}\r\n                placeholder=\"Search users by name, email, or ID...\"\r\n                className=\"w-full pl-11 pr-4 py-3 bg-slate-50 dark:bg-slate-900 border-none rounded-xl focus:ring-2 focus:ring-blue-500/20 font-medium text-sm text-slate-900 dark:text-white outline-none\"\r\n              />\r\n            </div>\r\n            <div className=\"relative\">\r\n              <select\r\n                value={roleFilter}\r\n                onChange={(e) => setRoleFilter(e.target.value)}\r\n                className=\"w-full pl-4 pr-10 py-3 bg-slate-50 dark:bg-slate-900 border-none rounded-xl focus:ring-2 focus:ring-blue-500/20 font-medium text-sm text-slate-900 dark:text-white outline-none appearance-none cursor-pointer\"\r\n              >\r\n                <option value=\"all\">All Roles</option>\r\n                <option value=\"buyer\">Buyers</option>\r\n                <option value=\"seller\">Sellers</option>\r\n                <option value=\"admin\">Admins</option>\r\n              </select>\r\n              <i className=\"ri-filter-3-line absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none\"></i>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Users Table */}\r\n        <div className=\"bg-white dark:bg-slate-800 rounded-[2rem] border border-slate-100 dark:border-slate-700 shadow-sm overflow-hidden\">\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full\">\r\n              <thead className=\"bg-slate-50/50 dark:bg-slate-800/50 border-b border-slate-100 dark:border-slate-700\">\r\n                <tr>\r\n                  <th className=\"px-8 py-5 text-left text-[10px] font-bold text-slate-400 uppercase tracking-widest leading-relaxed\">User Profile</th>\r\n                  <th className=\"px-8 py-5 text-left text-[10px] font-bold text-slate-400 uppercase tracking-widest leading-relaxed\">Status</th>\r\n                  <th className=\"px-8 py-5 text-left text-[10px] font-bold text-slate-400 uppercase tracking-widest leading-relaxed\">Role</th>\r\n                  <th className=\"px-8 py-5 text-right text-[10px] font-bold text-slate-400 uppercase tracking-widest leading-relaxed\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"divide-y divide-slate-100 dark:divide-slate-700\">\r\n                {filteredUsers.map((user) => {\r\n                  const online = isUserOnline(user);\r\n                  return (\r\n                    <tr key={user.id} className=\"hover:bg-slate-50/50 dark:hover:bg-slate-700/30 transition-colors\">\r\n                      <td className=\"px-8 py-4\">\r\n                        <div className=\"flex items-center gap-4 cursor-pointer\" onClick={() => handleEditRole(user)}>\r\n                          <div className=\"relative\">\r\n                            <div className=\"w-10 h-10 bg-slate-100 dark:bg-slate-700 rounded-xl flex items-center justify-center font-bold text-slate-500 dark:text-slate-400\">\r\n                              {user.full_name.charAt(0).toUpperCase()}\r\n                            </div>\r\n                            {online && (\r\n                              <span className=\"absolute -bottom-1 -right-1 w-3 h-3 bg-emerald-500 border-2 border-white dark:border-slate-800 rounded-full\"></span>\r\n                            )}\r\n                          </div>\r\n                          <div>\r\n                            <div className=\"font-bold text-sm text-slate-900 dark:text-white\">{user.full_name}</div>\r\n                            <div className=\"text-xs text-slate-500\">{user.email}</div>\r\n                          </div>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-8 py-4\">\r\n                        <div className=\"flex flex-col gap-1\">\r\n                          <span className={`inline-flex items-center gap-1.5 px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide w-fit ${user.is_active ? 'bg-emerald-100 text-emerald-700' : 'bg-rose-100 text-rose-700'}`}>\r\n                            <span className={`w-1.5 h-1.5 rounded-full ${user.is_active ? 'bg-emerald-500' : 'bg-rose-500'}`}></span>\r\n                            {user.is_active ? 'Active' : 'Suspended'}\r\n                          </span>\r\n                          <span className=\"text-[10px] text-slate-400 font-medium\">\r\n                            {online ? 'Online Now' : 'Offline'}\r\n                          </span>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-8 py-4\">\r\n                        <span className=\"px-2 py-1 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded text-[10px] font-bold uppercase tracking-wider border border-slate-200 dark:border-slate-600\">\r\n                          {user.role}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-8 py-4 text-right\">\r\n                        <button\r\n                          onClick={() => setOpenDropdown(openDropdown === user.id ? null : user.id)}\r\n                          className=\"p-2 text-slate-400 hover:text-blue-600 transition-colors\"\r\n                        >\r\n                          <i className=\"ri-more-2-fill text-xl\"></i>\r\n                        </button>\r\n                        {/* Dropdown */}\r\n                        {openDropdown === user.id && (\r\n                          <>\r\n                            <div className=\"fixed inset-0 z-10\" onClick={() => setOpenDropdown(null)}></div>\r\n                            <div className=\"absolute right-8 mt-2 w-48 bg-white dark:bg-slate-800 shadow-xl rounded-xl z-20 border border-slate-100 dark:border-slate-700 py-1 text-left\">\r\n                              <button onClick={() => handleEditRole(user)} className=\"block w-full text-left px-4 py-2 text-xs font-bold text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700\">View Details / Edit</button>\r\n                              <button onClick={() => handleDeleteUser(user.id)} className=\"block w-full text-left px-4 py-2 text-xs font-bold text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/20\">Delete User</button>\r\n                            </div>\r\n                          </>\r\n                        )}\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* View/Edit User Modal */}\r\n      {showEditModal && selectedUser && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200\">\r\n          <div className=\"bg-white dark:bg-slate-900 w-full max-w-2xl rounded-3xl shadow-2xl max-h-[90vh] overflow-y-auto outline-none border border-slate-100 dark:border-slate-800 flex flex-col\">\r\n\r\n            {/* Modal Header */}\r\n            <div className=\"px-8 py-6 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between sticky top-0 bg-white/95 dark:bg-slate-900/95 backdrop-blur z-10\">\r\n              <div>\r\n                <h3 className=\"text-2xl font-black text-slate-900 dark:text-white tracking-tight\">User Details</h3>\r\n                <p className=\"text-sm text-slate-500 font-medium\">View and manage user profile information</p>\r\n              </div>\r\n              <button\r\n                onClick={() => setShowEditModal(false)}\r\n                className=\"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-500 hover:bg-slate-200 transition-colors\"\r\n              >\r\n                <i className=\"ri-close-line text-xl\"></i>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Modal Body */}\r\n            <div className=\"p-8 space-y-8\">\r\n\r\n              {/* Read-Only Info Card */}\r\n              <div className=\"bg-slate-50 dark:bg-slate-950 rounded-2xl p-6 border border-slate-100 dark:border-slate-800 flex flex-col sm:flex-row gap-6 items-center sm:items-start\">\r\n                <div className=\"w-20 h-20 rounded-2xl bg-white dark:bg-slate-800 shadow-sm flex items-center justify-center text-3xl font-bold text-slate-300 uppercase shrink-0\">\r\n                  {editData.full_name.charAt(0)}\r\n                </div>\r\n                <div className=\"flex-1 text-center sm:text-left space-y-2 w-full\">\r\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <p className=\"text-[10px] uppercase font-bold text-slate-400\">User ID</p>\r\n                      <p className=\"text-xs font-mono text-slate-600 dark:text-slate-300 truncate w-full\" title={selectedUser.id}>{selectedUser.id}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-[10px] uppercase font-bold text-slate-400\">Email Address</p>\r\n                      <p className=\"text-sm font-bold text-slate-900 dark:text-white truncate\">{editData.email}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-[10px] uppercase font-bold text-slate-400\">Joined On</p>\r\n                      <p className=\"text-sm font-medium text-slate-600 dark:text-slate-300\">{new Date(editData.created_at).toLocaleDateString()}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-[10px] uppercase font-bold text-slate-400\">Status</p>\r\n                      <span className={`inline-flex px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide ${selectedUser.is_active ? 'bg-emerald-100 text-emerald-700' : 'bg-rose-100 text-rose-700'}`}>\r\n                        {selectedUser.is_active ? 'Active' : 'Suspended'}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Editable Fields */}\r\n              <div className=\"space-y-6\">\r\n                <h4 className=\"text-sm font-black text-slate-900 dark:text-white uppercase tracking-widest border-b border-slate-100 dark:border-slate-800 pb-2\">Profile Information</h4>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                  <div>\r\n                    <label className=\"text-xs font-bold uppercase tracking-wide text-slate-500 mb-2 block\">Full Name</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={editData.full_name}\r\n                      onChange={e => setEditData({ ...editData, full_name: e.target.value })}\r\n                      className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 rounded-xl border-none focus:ring-2 focus:ring-blue-500/50 outline-none font-medium\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"text-xs font-bold uppercase tracking-wide text-slate-500 mb-2 block\">Phone Number</label>\r\n                    <input\r\n                      type=\"tel\"\r\n                      value={editData.phone}\r\n                      onChange={e => setEditData({ ...editData, phone: e.target.value })}\r\n                      className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 rounded-xl border-none focus:ring-2 focus:ring-blue-500/50 outline-none font-medium\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"text-xs font-bold uppercase tracking-wide text-slate-500 mb-2 block\">Student ID</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={editData.student_id}\r\n                      onChange={e => setEditData({ ...editData, student_id: e.target.value })}\r\n                      className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 rounded-xl border-none focus:ring-2 focus:ring-blue-500/50 outline-none font-medium\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"text-xs font-bold uppercase tracking-wide text-slate-500 mb-2 block\">Department</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={editData.department}\r\n                      onChange={e => setEditData({ ...editData, department: e.target.value })}\r\n                      className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 rounded-xl border-none focus:ring-2 focus:ring-blue-500/50 outline-none font-medium\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div>\r\n                <h4 className=\"text-sm font-black text-slate-900 dark:text-white uppercase tracking-widest border-b border-slate-100 dark:border-slate-800 pb-2 mb-4\">Role Assignment</h4>\r\n                <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3\">\r\n                  {['buyer', 'seller', 'admin', 'news_publisher'].map(role => (\r\n                    <div\r\n                      key={role}\r\n                      onClick={() => setEditData({ ...editData, role })}\r\n                      className={`cursor-pointer px-4 py-3 rounded-xl border-2 transition-all flex flex-col items-center justify-center gap-2 text-center ${editData.role === role\r\n                        ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\r\n                        : 'border-slate-100 dark:border-slate-800 hover:border-slate-300'\r\n                        }`}\r\n                    >\r\n                      <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${editData.role === role ? 'border-blue-500' : 'border-slate-300'\r\n                        }`}>\r\n                        {editData.role === role && <div className=\"w-2.5 h-2.5 rounded-full bg-blue-500\"></div>}\r\n                      </div>\r\n                      <span className=\"text-xs font-bold text-slate-700 dark:text-slate-200 capitalize\">{role.replace('_', ' ')}</span>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Account Management Actions */}\r\n              <div className=\"space-y-6 pt-6 border-t border-slate-100 dark:border-slate-800\">\r\n                <h4 className=\"text-sm font-black text-slate-900 dark:text-white uppercase tracking-widest flex items-center gap-2\">\r\n                  <i className=\"ri-shield-flash-line text-rose-500\"></i>\r\n                  Account Management\r\n                </h4>\r\n\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                  <button\r\n                    onClick={() => handleToggleActive(selectedUser.id, selectedUser.is_active)}\r\n                    className={`flex items-center justify-center gap-3 p-5 rounded-2xl border-2 transition-all font-bold text-xs uppercase tracking-widest active:scale-95 ${selectedUser.is_active\r\n                      ? 'border-amber-100 bg-amber-50 text-amber-700 hover:bg-amber-100 dark:bg-amber-900/10 dark:border-amber-900/20'\r\n                      : 'border-emerald-100 bg-emerald-50 text-emerald-700 hover:bg-emerald-100 dark:bg-emerald-900/10 dark:border-emerald-900/20'\r\n                      }`}\r\n                  >\r\n                    <i className={selectedUser.is_active ? 'ri-user-forbid-line text-lg' : 'ri-user-follow-line text-lg'}></i>\r\n                    {selectedUser.is_active ? 'Suspend Account' : 'Activate Account'}\r\n                  </button>\r\n\r\n                  <button\r\n                    onClick={async () => {\r\n                      await handleDeleteUser(selectedUser.id);\r\n                      setShowEditModal(false);\r\n                    }}\r\n                    className=\"flex items-center justify-center gap-3 p-5 rounded-2xl border-2 border-rose-100 bg-rose-50 text-rose-700 hover:bg-rose-100 dark:bg-rose-900/10 dark:border-rose-900/20 transition-all font-bold text-xs uppercase tracking-widest active:scale-95\"\r\n                  >\r\n                    <i className=\"ri-delete-bin-line text-lg\"></i>\r\n                    Delete Profile\r\n                  </button>\r\n                </div>\r\n\r\n                <p className=\"text-[10px] text-slate-400 font-bold uppercase tracking-widest leading-relaxed px-1\">\r\n                  <i className=\"ri-information-line mr-1 text-blue-500\"></i>\r\n                  Suspending blocks access while keeping data. Deleting permanently removes the profile.\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Modal Footer */}\r\n            <div className=\"p-6 border-t border-slate-100 dark:border-slate-800 flex gap-4 sticky bottom-0 bg-white dark:bg-slate-900 z-10\">\r\n              <button\r\n                onClick={() => setShowEditModal(false)}\r\n                className=\"flex-1 py-4 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 font-bold rounded-xl hover:bg-slate-200 transition-colors uppercase tracking-widest text-xs\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={handleSaveUser}\r\n                disabled={saving}\r\n                className=\"flex-[2] py-4 bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-bold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 uppercase tracking-widest text-xs\"\r\n              >\r\n                {saving ? <i className=\"ri-loader-4-line animate-spin\"></i> : <i className=\"ri-save-line\"></i>}\r\n                Save Changes\r\n              </button>\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Add User Modal */}\r\n      {showAddModal && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200\">\r\n          <div className=\"bg-white dark:bg-slate-900 w-full max-w-2xl rounded-3xl shadow-2xl max-h-[90vh] overflow-y-auto outline-none border border-slate-100 dark:border-slate-800 flex flex-col\">\r\n            <div className=\"px-8 py-6 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between sticky top-0 bg-white/95 dark:bg-slate-900/95 backdrop-blur z-10\">\r\n              <div>\r\n                <h3 className=\"text-2xl font-black text-slate-900 dark:text-white tracking-tight\">Create User</h3>\r\n                <p className=\"text-sm text-slate-500 font-medium\">Add a new user to the platform (Auto-confirm email)</p>\r\n              </div>\r\n              <button\r\n                onClick={() => setShowAddModal(false)}\r\n                className=\"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-500 hover:bg-slate-200 transition-colors\"\r\n              >\r\n                <i className=\"ri-close-line text-xl\"></i>\r\n              </button>\r\n            </div>\r\n\r\n            <form onSubmit={handleAddUser} className=\"p-8 space-y-6\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                <div>\r\n                  <label className=\"text-xs font-bold uppercase tracking-wide text-slate-500 mb-2 block\">Full Name</label>\r\n                  <input\r\n                    required\r\n                    type=\"text\"\r\n                    value={newData.fullName}\r\n                    onChange={e => setNewData({ ...newData, fullName: e.target.value })}\r\n                    className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 rounded-xl border-none focus:ring-2 focus:ring-blue-500/50 outline-none font-medium\"\r\n                    placeholder=\"John Doe\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-xs font-bold uppercase tracking-wide text-slate-500 mb-2 block\">Email Address</label>\r\n                  <input\r\n                    required\r\n                    type=\"email\"\r\n                    value={newData.email}\r\n                    onChange={e => setNewData({ ...newData, email: e.target.value })}\r\n                    className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 rounded-xl border-none focus:ring-2 focus:ring-blue-500/50 outline-none font-medium\"\r\n                    placeholder=\"user@example.com\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-xs font-bold uppercase tracking-wide text-slate-500 mb-2 block\">Password</label>\r\n                  <input\r\n                    required\r\n                    type=\"password\"\r\n                    value={newData.password}\r\n                    onChange={e => setNewData({ ...newData, password: e.target.value })}\r\n                    className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 rounded-xl border-none focus:ring-2 focus:ring-blue-500/50 outline-none font-medium\"\r\n                    placeholder=\"\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-xs font-bold uppercase tracking-wide text-slate-500 mb-2 block\">Phone Number</label>\r\n                  <input\r\n                    required\r\n                    type=\"tel\"\r\n                    value={newData.phone}\r\n                    onChange={e => setNewData({ ...newData, phone: e.target.value })}\r\n                    className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 rounded-xl border-none focus:ring-2 focus:ring-blue-500/50 outline-none font-medium\"\r\n                    placeholder=\"024XXXXXXX\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-xs font-bold uppercase tracking-wide text-slate-500 mb-2 block\">Faculty</label>\r\n                  <select\r\n                    required\r\n                    value={newData.faculty}\r\n                    onChange={e => setNewData({ ...newData, faculty: e.target.value })}\r\n                    className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 rounded-xl border-none focus:ring-2 focus:ring-blue-500/50 outline-none font-medium\"\r\n                  >\r\n                    <option value=\"\">Select Faculty</option>\r\n                    <option value=\"Faculty of Business\">Faculty of Business</option>\r\n                    <option value=\"Faculty of Science & Computing\">Faculty of Science & Computing</option>\r\n                    <option value=\"Faculty of Nursing & Midwifery\">Faculty of Nursing & Midwifery</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className=\"text-xs font-bold uppercase tracking-wide text-slate-500 mb-2 block\">Department</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={newData.department}\r\n                    onChange={e => setNewData({ ...newData, department: e.target.value })}\r\n                    className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 rounded-xl border-none focus:ring-2 focus:ring-blue-500/50 outline-none font-medium\"\r\n                    placeholder=\"e.g. IT\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"text-xs font-bold uppercase tracking-wide text-slate-500 mb-4 block\">Initial Role</label>\r\n                <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3\">\r\n                  {['buyer', 'seller', 'admin', 'news_publisher'].map(role => (\r\n                    <div\r\n                      key={role}\r\n                      onClick={() => setNewData({ ...newData, role })}\r\n                      className={`cursor-pointer px-4 py-3 rounded-xl border-2 transition-all flex flex-col items-center justify-center gap-2 text-center ${newData.role === role ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20' : 'border-slate-100 dark:border-slate-800'}`}\r\n                    >\r\n                      <span className=\"text-xs font-bold text-slate-700 dark:text-slate-200 capitalize\">{role.replace('_', ' ')}</span>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"pt-6 flex gap-4\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowAddModal(false)}\r\n                  className=\"flex-1 py-4 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 font-bold rounded-xl hover:bg-slate-200 transition-colors uppercase tracking-widest text-xs\"\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  type=\"submit\"\r\n                  disabled={saving}\r\n                  className=\"flex-[2] py-4 bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-bold rounded-xl hover:shadow-lg transition-all flex items-center justify-center gap-2 uppercase tracking-widest text-xs\"\r\n                >\r\n                  {saving ? <i className=\"ri-loader-4-line animate-spin text-lg\"></i> : <i className=\"ri-user-add-line text-lg\"></i>}\r\n                  Create User Account\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Success Toast */}\r\n      {showSuccessToast && (\r\n        <div className=\"fixed top-24 right-4 z-50 animate-bounce px-6 py-4 rounded-2xl bg-emerald-500 text-white shadow-xl flex items-center gap-3\">\r\n          <i className=\"ri-checkbox-circle-fill text-xl\"></i>\r\n          <span className=\"font-bold\">Profile Updated!</span>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}"],"file":"UserManagement-Brj98o4x.js"}